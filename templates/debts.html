{% extends "base.html" %}
{% from "_macros.html" import pagination_widget %} {# –ï—Å–ª–∏ —É –≤–∞—Å –±—É–¥–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –¥–æ–ª–≥–æ–≤ #}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-5 col-lg-4 mb-4">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ª–≥</h2>
            {# –í–ê–ñ–ù–û: enctype="multipart/form-data" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ #}
            <form method="POST" action="{{ url_for('debts') }}" enctype="multipart/form-data">
                {{ form.hidden_tag() }}

                <div class="mb-3">
                    {{ form.party_name.label(class="form-label") }}
                    {{ form.party_name(class="form-control" + (" is-invalid" if form.party_name.errors else "")) }}
                    {% if form.party_name.errors %}<div class="invalid-feedback">{% for e in form.party_name.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>
                <div class="mb-3">
                    {{ form.amount.label(class="form-label") }}
                    {{ form.amount(class="form-control" + (" is-invalid" if form.amount.errors else ""), placeholder="0.00") }}
                    {% if form.amount.errors %}<div class="invalid-feedback">{% for e in form.amount.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>
                <div class="mb-3">
                    {{ form.direction.label(class="form-label") }}
                    {{ form.direction(class="form-select" + (" is-invalid" if form.direction.errors else "")) }}
                    {% if form.direction.errors %}<div class="invalid-feedback">{% for e in form.direction.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>
                <div class="mb-3">
                    {{ form.due_date.label(class="form-label") }}
                    {{ form.due_date(class="form-control" + (" is-invalid" if form.due_date.errors else "")) }}
                    {% if form.due_date.errors %}<div class="invalid-feedback">{% for e in form.due_date.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>
                 <div class="mb-3">
                    {{ form.category.label(class="form-label") }}
                    {{ form.category(class="form-select" + (" is-invalid" if form.category.errors else "")) }}
                     {% if form.category.errors %}<div class="invalid-feedback">{% for e in form.category.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>
                <div class="mb-3">
                    {{ form.notes.label(class="form-label") }}
                    {{ form.notes(class="form-control" + (" is-invalid" if form.notes.errors else ""), rows=3) }}
                    {% if form.notes.errors %}<div class="invalid-feedback">{% for e in form.notes.errors %}{{e}}{% endfor %}</div>{% endif %}
                </div>

                {# –ù–û–í–û–ï –ü–û–õ–ï –î–õ–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø #}
                <div class="mb-3">
                    {{ form.image.label(class="form-label") }}
                    {{ form.image(class="form-control" + (" is-invalid" if form.image.errors else "")) }}
                    {% if form.image.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.image.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>
                {# –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ü–û–õ–Ø #}

                <div class="d-grid">
                    {{ form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>
        <div class="col-md-7 col-lg-8">
            <h2>–í—Å–µ –¥–æ–ª–≥–∏</h2>
            {% if debts %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>–ö–æ–º—É/–û—Ç –∫–æ–≥–æ</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
                            <th>–°—Ä–æ–∫</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ó–∞–º–µ—Ç–∫–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for debt in debts %}
                        {# –ó–¥–µ—Å—å today_date() –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ #}
                        <tr class="{{ 'table-success' if debt.is_paid else ('table-warning' if debt.due_date and debt.due_date < today_date and not debt.is_paid else '') }}">
                            <td>{{ debt.party_name }}</td>
                            <td>{{ "%.2f"|format(debt.amount) }}</td>
                            <td>{{ '–Ø –æ–¥–æ–ª–∂–∏–ª' if debt.direction == 'lent' else '–Ø –∑–∞–Ω—è–ª' }}</td>
                            <td>{{ debt.due_date.strftime('%d.%m.%Y') if debt.due_date else '-' }}</td>
                            <td>{{ debt.category.name if debt.category else '-'}}</td>
                            <td>{{ debt.notes|truncate(30, True) if debt.notes else '-' }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('toggle_debt_paid', debt_id=debt.id) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-sm {{ 'btn-success' if debt.is_paid else 'btn-outline-secondary' }}">
                                        {{ '–ü–æ–≥–∞—à–µ–Ω' if debt.is_paid else '–ù–µ –ø–æ–≥–∞—à–µ–Ω' }}
                                    </button>
                                </form>
                            </td>
                            <td>
                                {# –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏ –¥–æ–ª–≥–∞, –µ—Å–ª–∏ –±—É–¥–µ—Ç —Ç–∞–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ #}
                                {# <a href="{{ url_for('debt_detail', debt_id=debt.id) }}" class="btn btn-info btn-sm" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">üëÅÔ∏è</a> #}
                                <form method="POST" action="{{ url_for('delete_debt', debt_id=debt.id) }}" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–ª–≥?');">
                                    <button type="submit" class="btn btn-danger btn-sm" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {# –ï—Å–ª–∏ –±—É–¥–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –¥–æ–ª–≥–æ–≤ #}
            {# {% if pagination_debts %}
                {{ pagination_widget(pagination_debts, 'debts') }}
            {% endif %} #}
            {% else %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –¥–æ–ª–≥–∞—Ö.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}