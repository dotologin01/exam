{% extends "base.html" %}
{% from "_macros.html" import pagination_widget %} {# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–∞–∫—Ä–æ—Å –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ #}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-5 col-lg-4 mb-4"> {# –ù–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª —à–∏—Ä–∏–Ω—É –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∏–¥–∞ #}
            <h2>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h2>
            {# –í–ê–ñ–ù–û: enctype="multipart/form-data" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ #}
            <form method="POST" action="{{ url_for('expenses') }}" enctype="multipart/form-data">
                {{ form.hidden_tag() }} {# CSRF —Ç–æ–∫–µ–Ω #}

                <div class="mb-3">
                    {{ form.amount.label(class="form-label") }}
                    {{ form.amount(class="form-control" + (" is-invalid" if form.amount.errors else ""), placeholder="0.00") }}
                    {% if form.amount.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.amount.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.date.label(class="form-label") }}
                    {{ form.date(class="form-control" + (" is-invalid" if form.date.errors else "")) }}
                    {% if form.date.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.date.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.category.label(class="form-label") }}
                    {{ form.category(class="form-select" + (" is-invalid" if form.category.errors else "")) }} {# –ò—Å–ø–æ–ª—å–∑—É–µ–º form-select –¥–ª—è <select> #}
                    {% if form.category.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.category.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), rows="3") }}
                    {% if form.description.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.description.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>

                {# –ù–û–í–û–ï –ü–û–õ–ï –î–õ–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø #}
                <div class="mb-3">
                    {{ form.image.label(class="form-label") }}
                    {{ form.image(class="form-control" + (" is-invalid" if form.image.errors else "")) }}
                    {% if form.image.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.image.errors %}<span>{{ error }}</span>{% endfor %}
                        </div>
                    {% endif %}
                </div>
                {# –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ü–û–õ–Ø #}

                <div class="d-grid"> {# –î–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ #}
                    {{ form.submit(class="btn btn-primary") }}
                </div>
            </form>
        </div>

        <div class="col-md-7 col-lg-8"> {# –ù–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª —à–∏—Ä–∏–Ω—É #}
            <h2>–í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã</h2>
            {% if transactions %}
            <div class="table-responsive"> {# –î–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã #}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–°—É–º–º–∞</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions %}
                        <tr>
                            <td>{{ transaction.date.strftime('%d.%m.%Y') }}</td>
                            <td>{{ "%.2f"|format(transaction.amount) }}</td>
                            <td>{{ transaction.category.name }}</td>
                            <td>{{ transaction.description|truncate(30, True) if transaction.description else '-' }}</td>
                            <td>
                                <a href="{{ url_for('transaction_detail', transaction_id=transaction.id) }}" class="btn btn-info btn-sm" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ">üëÅÔ∏è</a>
                                <form method="POST" action="{{ url_for('delete_transaction', transaction_id=transaction.id) }}" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?');">
                                    <button type="submit" class="btn btn-danger btn-sm" title="–£–¥–∞–ª–∏—Ç—å">√ó</button>
                                </form>
                                {# –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –±—É–¥–µ—Ç #}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if pagination %}
                {{ pagination_widget(pagination, 'expenses') }} {# –ò—Å–ø–æ–ª—å–∑—É–µ–º endpoint 'expenses' –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ #}
            {% endif %}
            {% else %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ —Ä–∞—Å—Ö–æ–¥–∞—Ö.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}